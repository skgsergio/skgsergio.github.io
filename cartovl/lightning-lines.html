<!DOCTYPE html>
<html>
  <head>
    <title>Lightning</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <script src="https://libs.cartocdn.com/carto-vl/v0.4.0/carto-vl.js"></script>
    <script src="https://libs.cartocdn.com/mapbox-gl/v0.45.0-carto1/mapbox-gl.js"></script>
    <link href="https://libs.cartocdn.com/mapbox-gl/v0.45.0-carto1/mapbox-gl.css" rel="stylesheet" />
    <style type="text/css">
     body {
       margin: 0;
       padding: 0;
     }
     #map {
       position: absolute;
       height: 100%;
       width: 100%;
     }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script type="text/javascript">
     const map = new mapboxgl.Map({
       container: 'map',
       style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
       center: [-35, 35],
       zoom: 2,
       dragRotate: false
     });
     map.addControl(new mapboxgl.NavigationControl({showCompass: false}));

     carto.setDefaultAuth({
       user: 'sconde-carto',
       apiKey: '8UvSIPPw9mrzCk1wD_DRtA'
     });

     const lightnings_layer = new carto.Layer(
       'lightnings_layer',
       new carto.source.Dataset('lightning_1528056919_points'),
       new carto.Viz(`
color: ramp(linear($mcg, 360, 0), ORYEL)
width: ramp(linear($mcg, 0, 360), [8, 7, 6, 5, 4, 3])
strokeWidth: 0
filter: torque($timestamp, 50, fade(0, 0.5))
       `));

     const lines_layer = new carto.Layer(
       'lines_layer',
       new carto.source.Dataset('lightning_1528056919_lines'),
       new carto.Viz(`
color: #d1eeea06
width: 1
filter: torque($timestamp, 50, fade(0, 0.5))
       `));

     const stations_layer = new carto.Layer(
       'stations_layer',
       new carto.source.Dataset('lightning_1528056919_sta'),
       new carto.Viz(`
color: #d1eeea20
strokeWidth: 0
width: 2
       `));

     lines_layer.addTo(map);
     stations_layer.addTo(map);
     lightnings_layer.addTo(map);
    </script>
  </body>
</html>
